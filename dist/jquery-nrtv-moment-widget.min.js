!function(t){var e;t.fn.nrtvScrubb=function(o,n,r){function a(t,e){var o=this;o.cookieName="nrtv-codepen",o.apiUrl="https://narrativeapp.com/"}function u(o,n,i){var r=this,u=new a(n,i),c=e.width();r.momentPhotos=[],t(document).resize(function(){c=e.width()}),u.getMoment(o,function(o){t(".nrtv__meta",e).html('<a href="https://getnarrative.com/shared/moment/'+o.uuid+'"><b>'+o.caption+"</b></a>")}),u.getPhotos(o,function(o){var n=[];t.each(o,function(t,e){n.push(e.renders.g1_smartphone.url)}),t(e).mousemove(function(t){var e=Math.round(t.pageX/c*1e3)/10,o=Math.round((n.length-1)*(e/100));r.updateScrubb(o,n)}),r.updateScrubb(0,n),r.preloadPhoto(n),e.removeClass("nrtv__loading")})}e=this,t(document).ready(function(){new u(o,n,r)}),a.prototype.getAnonymousToken=function(e){var o=this;if(o.token)return e(o.token);var i=("; "+document.cookie).split("; "+o.cookieName+"=");if(2==i.length)return o.token=JSON.parse(i.pop().split(";").shift()),e(o.token);var a=o.apiUrl+"oauth2/token/?"+t.param({grant_type:"client_credentials"});t.ajax({url:a,method:"post",beforeSend:function(t){t.setRequestHeader("Authorization","Basic "+btoa(n+":"+r))}}).done(function(t){var n=new Date;return n.setTime(n.getTime()+864e5),document.cookie=o.cookieName+"="+JSON.stringify(t)+"; expires="+n.toGMTString()+"; path=/",o.token=t,e(t)})},a.prototype.api=function(e,o){var n=this;n.getAnonymousToken(function(i){t.ajax({url:n.apiUrl+"/api/v2"+e,beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+i.access_token)}}).done(function(t){o(t)})})},a.prototype.getPhotos=function(t,e){this.api("/moments/"+t+"/photos/?limit=9999",function(t){e(t.results)})},a.prototype.getMoment=function(t,e){this.api("/moments/"+t+"/",function(t){e(t)})},u.prototype.preloadPhoto=function(t){var e=[];for(i=0;i<t.length;i++)e[i]=new Image,e[i].src=t[i]},u.prototype.updateScrubb=function(o,n){e.css({"background-image":"url("+n[o]+")"}),t(".nrtv__progress",e).css({width:o/n.length*100+"%"})}}}(jQuery);
